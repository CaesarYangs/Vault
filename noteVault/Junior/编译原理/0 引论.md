
# Class Intro
计算学科以抽象、理论、设计为其学科形态，其问题求解的基本路径是“问题、形式化描述、计算机化”。编译原理涉及比较适当的抽象层面上的数据变换，既有需要抽象描述的问题，又有较成熟的理论，而且在限定规模下又能实现（设计），是理论和实践结合最好的重要学科基础课程之一。除了相应的知识对该学科的人才非常重要外，一些基本的问题求解技术、方法和思想更为重要，以至于在每个计算机科技工作者的生涯中，它们都会被反复用到，是计算思维的重要内容。本课程依据学生的特点，以总体结构为主线，选择语言描述、词法分析、语法分析、中间代码生成作为主要内容，讨论编译系统设计与实现及其相关的方法和原理。

---
# 编译程序
从功能上看，一个编译程序就是一个语言翻译程序。**其将一种语言书写的程序翻译成另一种（目标语言）的等价程序。**
编译程序是现代计算机的基本组成部分之一。

**什么是编译器**
编译器是一个程序

**编译器的核心功能**
编译器的核心功能是==将源程序代码翻译成目标代码==

**功能过程**
编译器------>(静态计算)------>目标程序------>计算机------>(动态计算)------>计算结果

> 所生成的目标程序要和源代码语义相同

> 一个编译程序的重要性体现在它使得多数计算机用户不必考虑与机器有关的烦琐细节，使程序员和程序设计专家独立于机器，这对于当今机器的数量和种类持续不断地增长的年代尤为重要。

一个编译程序的输入可能要由一个或多个预处理程序来产生；
优化：<u>另外，为得到能运行的机器代码，编译程序的输出可能仍需要进一步地处理。</u>

**编译器和解释器**
解释器也是处理程序的一种程序
- 编译器的最终输出是***可执行程序***——offline
- 解释器的最终输出是程序***运行的结果***——online （相当于编译程序的同时将其运行了）
	- 输入源代码，**直接输出执行结果**。
	- JVM 就是一个解释器，而不是一个单纯的编译器。输入 java 字节码 bytecode ，然后直接输出执行结果，而不是输出汇编代码。

# 编译器简史
- 第一个编译器是Fortran语言的编译器
	- 该编译器给计算机科学的发展产生了巨大的影响：
		- 理论上：算法、数据结构、形式语言与自动机
		- 实践上：软件工程、体系结构等
		- 编译器架构

# 编译器结构
编译器具有非常模块化的高层结构

**“前端”与“后端”**
处理输入+处理后续指令转写计算等

## Phase
**编译器可以看成多个阶段构成的流水线结构。**
一个编译程序的整个工作过程是划分阶段执行的。各个阶段进行的操作是逻辑上紧密连接的。
即：编译器的模块化高层结构。

> 编译器由多个阶段组成，每个阶段要处理不同的问题。

***编译器设计中的重要问题是如何合理划分，组织各个阶段***

- **一种简化的编译器结构**
所有步骤都和[[3 语义分析#符号表|符号表]]有交集

| 0        | 1词法分析  | 2语法分析        | 3语义分析  | 4代码生成  |
| -------- | ---------- | ---------------- | ---------- | ---------- |
| 字符序列 | ->记号序列 | ->**抽象语法树** | ->中间代码 | ->目标代码 |


- **一种更贴近实际的复杂编译器结构**
依然保持为流水线结构。但在每个部分进行了更为详细的展开。


## 结构概述
**1. 词法分析**
第一个阶段。
逐个字符读入源程序，对字符扫描和分解，识别单词和符号。

**2.语法分析**
在1的基础上将单词序列分解为各类语法短语，如程序、语句、表达式,etc.
可表示成语法树。

语法分析的依据是语言的语法规则，即描述程序的规则。
> 词法分析和语法分析本质上都是对源程序的结构进行分析。但词法分析的任务仅对源程序进行线性扫描即可完成，比如识别标识符，因为标识符的结构是字母打头的字母和数字串，这只要顺序扫描输入流，遇到既不是字母又不是数字的字符时，将前面所发现的所有字母和数字组合在一起构成标识符单词即可。但这种线性扫描不能用于识别递归定义的语法成分，比如不能用此办法去匹配表达式中的括号。

**3.语义分析**
审查源程序有无语义错误，为代码生成阶段收集类型信息。

**4.中间代码生成**
完成以上工作后，有些编译程序将源程序变成一种内部表示形式，so called "中间代码".

> 中间代码是一种结构简单、含义明确的记号系统。可以设计为多样形式。
> 一容易生成，二容易被翻译为目标代码。

**5.代码优化**
对前一阶段中间代码进行变换和改造，以使得生成的目标代码更高效，节省时间与空间。

**6.目标代码生成**
编译的最后阶段。
把中间代码变换成特定机器上的绝对指令代码或汇编指令代码。
> 这是编译的最后阶段，它的工作与硬件系统结构和指令含义有关，这个阶段的工作很复杂，涉及硬件系统功能部件的运用、机器指令的选择、各种数据类型变量的存储空间分配以及寄存器和后缓寄存器的调度等。

**表格管理/符号表**
与上述阶段都有联系。编译过程中各种信息被保留在不同的表格里。

**出错处理**
与上述阶段都有联系。在编译过程中出错时报告错误性质和发生地点。


# 编译器实例
**栈式计算机Stack**
只有一个数据结构：栈
两条指令：
- push n
- add

> JVM就是一个栈式计算机
> 栈式计算机的实现相对简单

**编译器实现**
1. 词法语法分析
2. 语法树构建

编译器构造和具体的编译器目标有关
- 前端：生成语法树
- 后端：生成目标代码


# Q&A
- **编译器的主要功能是什么**
编译器的核心功能是将源程序代码翻译成目标代码。最终成为能够被直接使用的可执行程序。
- **编译器一般采用的功能组织结构是什么？为什么？**
编译器可以看做是多个阶段构成的流水线结构。其具有非常模块化的高层结构。
使用这种结构的原因是：每个阶段中要处理不同的问题，同时每个阶段使用不同的理论，数据结构和算法来实现。不同的模块只需要关注当前所需的操作内容，将其独立且高效地实现。将不同的功能独立划分，在宏观上构成一条链式流水线最终完成任务，也会使编译器更容易实现和维护。


翻译
一边是高级语言 一边是机器语言 编译器即两边都需要精通


