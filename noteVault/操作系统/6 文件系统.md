
文件的组织结构，存取结构，保护以及文件系统空间管理问题。

# 文件系统概念
操作系统对计算机的管理：
- 硬件管理：CPU，存储器，设备
- 软件管理：系统程序，工具软件，中间件，库函数

*怎样对软件资源（程序和数据）进行透明地快速存取问题？*

文件系统把程序和数据看做文件，并把他们存放在磁带或磁盘等大容量存储介质上，从而做到对程序和数据的透明存取。

*何为透明存取？*
不必了解文件存储在磁盘中的具体部分，只需利用文件名，文件系统就会自动完成相关文件操作。

完成以下工作：
- 对外存统一管理
- 拥有文件逻辑结构，实现文件按名存取
- 文件物理结构
- 可以进行文件信息查找
- 实现文件共享与保护

## 文件与文件系统
**文件**
一段程序或数据的集合。

- 无结构文件
- 流式文件


**文件系统**
OS中与管理文件有关的软件和数据。负责建立，撤销，修改，和复制文件，还负责对文件按名存取和存取控制。
- 友好的用户接口
- 对文件按名存取，对用户透明
- 某些文件可被多个用户或进程共享
- 文件系统使用大容量存储器作为介质，可存储大量信息

**文件的分类**
- 系统文件
- 库文件
- 用户文件

- 普通文件
- 目录文件
- 特殊文件

文件的分类主要是便于系统对不同文件进行不同的管理，从而提高处理速度和起到保护和共享的作业。

# 文件逻辑结构与存取方法——操作软件
无论对于何种存取方法，找到的操作对象——记录或字符流信息，找到的都是他们的逻辑地址。


## 逻辑结构
文件的逻辑结构是用户可见的结构。
分类：
- 字符流式无结构文件
- 记录式有结构文件

对于字符流式无结构文件，查找困难但管理简单。对基本信息单位操作不多的文件适合采用字符流式无结构方式。

记录式有结构文件把文件中的记录按各种不同方式排列，构成不同的逻辑结构，以便用户对文件中的记录进行修改，追加，查找和管理操作。

**常用的记录式文件结构**
- 连续结构
- 多重结构
- 转置结构
- 顺序结构

## 存取方法
- 顺序存取法
- 随机存取法（直接存取法）
- 按关键字存取法

**文件搜索算法**
- 线性搜索法
- 散列法
- 二分搜索法

# 文件物理结构与存储设备——操作硬件
从文件的逻辑地址映射到物理地址，再对物理地址进行有关信息的操作。
由逻辑地址到物理地址的映射是和文件的存储方式也就是**文件的物理结构**紧密相关的。
文件系统采用哪种存取方法和逻辑结构，实际上是和**物理存储介质**有关的。

说白了：管理文件与文件块（逻辑块号or物理块号）
## 物理结构
**文件的物理结构是指文件在存储设备上的存放方法。** 

事实上，由于文件的**物理结构决定了**文件信息在存储设备上的**存储位置**，因此，文件信息的逻辑块号（逻辑地址）到物理块号(物理地址)的**变换也是由文件的物理结构决定的**。

**以块作为分配和传送信息的基本单位**
在文件系统中，文件的存储设备通常划分为若干大小相等的物理块，每块长512B或1024B。
同样，将文件信息划分为与物理存储设备物理块大小相等的逻辑块。

常用的文件物理结构：
- 连续文件
- 串联文件
- 索引文件

**索引文件**
要求OS为每个文件建立一张索引表，表中指出文件的所在的逻辑块号和与之对应的物理块号。索引表自身的物理地址则由文件说明信息给出。

索引结构既适用于顺序存取，也适用于随机存取。

当文件索引表大小超过一个物理块，索引表可使用多重索引方式（间接索引）。
即：索引表中存储的是这些信息的物理块地址。
> 通过一级间接索引，可寻址文件长度变为n * n ，若再大于，可使用二级间接索引。


**索引缺点**
由于使用了索引表而增加了存储空间的开销。另外，在存取文件时需要至少访问存储器两次以上。

由于文件在存储设备的访问速度较慢，因此，如果把索引表放在存储设备上，势必大大降低文件的存取速度。*一种改进的方法是*，当对某个文件进行操作之前，系统预先把索引表放入内存。这样，文件的存取就可直接在内存通过索引表确定物理地址块号，而访问磁盘的动作只需要一次。

## 文件存储设备
**顺序 存储设备**——磁带
- 信息密度
- 磁带带速
- 块间间隙

**直接存取 存储设备**——磁盘
磁盘允许文件系统直接存取磁盘上的任意物理块。

# 文件存储-空间管理
保证了多用户共享文件存储设备以及实现文件按名存取。

**空间管理实际上是：空闲块的组织管理问题**
*空闲块分配*
*空闲块回收*

- **空闲文件目录**
	- 最简单的空闲块管理方法
	- 把文件存储设备中的空闲块的块号统一放在一个称为空闲文件目录的物理块中。其中空闲文件目录的每个表项对应一个由多个空闲块构成的空闲区，它包括空闲块个数、空闲块号和第一个空闲块号等。

适用于连续文件结构的文件存储区分配与回收。
***类似于存储管理的：单一连续区存储分配和释放算法。***

- **空闲块链**
	- 较常用的管理方法。即链接。
	- 类似于内存管理中，动态分区管理的自由链管理法[[5 存储管理#动态分区法]]。
	- 常用——**成组链法**

- **位示图**
	- 为了提高空闲块分配和回收速度而产生。


# 文件目录管理
为了实现文件的按名存取，每个文件必须有一个文件名与之对应。

将文件名及其结构信息按一定组织结构排列，以方便文件的搜索。
文件目录管理除了解决存储空间有效利用之外，还要解决快速搜索、文件命名冲突及文件共享问题。

## 文件组成
文件说明+文件体

文件说明：文件控制块FCB 各种信息
文件体：文件本身的信息

## 文件目录
**单级目录**
文件系统可实现对文件系统空间的自动管理和按名存取。

**二级目录**
各个文件的说明信息被组织成目录文件，且以用户为单位把各自的文件划分为不同的组。
二级目录可以解决文件重名和文件共享问题。

从MFD找目录名，从中找到该用户的MFD

**多级目录**
上层为目录，最底层为文件。

- 层次清楚
- 解决文件重名问题
- 查找搜索速度快

**便于共享的文件目录**
- 绕道法
- 链接发
- 基本文件目录表BFD

## 目录管理


# 文件存取控制
文件存取控制是和文件的共享，保护和保密3个不同但又互相连续的问题紧密相关的。

以下4种方法验证用户存取操作：
- 存取控制矩阵
- 存取控制表
- 口令
- 密码术

# 文件系统的层次模型

![](http://c.biancheng.net/cpp/uploads/allimg/140701/1-140F11J145964.jpg)

