# Introduction

## 网络软件
### 协议层次结构
为了降低网络设计的复杂性，绝大多数网络都组织成一个层次栈(a stack of layer)或分级栈(a stack of level)，每一层都建立在其下一层的基础之上。

一台机器上的第 n 层与另一台机器上的第 n 层进行对话，该对话中使用的规则和约定 统称为第 n 层协议。基本上，所谓协议(protocol)是指通信双方就如何进行通信的一种约定。

在一对相邻层次之间的是接口(interface)。 

实际上，数据并不是从一台机器的第 n 层直接传递到另一台机器的第 n 层。相反，每 一层都将数据和控制信息传递给它的下一层，这样一直传递到最低层。第 1 层下面是物理 介质(physical medium)，通过它进行实际的通信

除了尽可能地减少层与层之间必须要传递的信 息量外，层与层之间清晰的接口使得同层协议的替换更加容易，即某一层的当前协议或实 现替换成另一个完全不同的协议或者实现

==层和协议的集合称为网络体系结构(network architecture)==

**一个特定的系统所使用的一组协议，即每一层一个协议，称为协议栈(protocol stack)。网络体系结构、协议栈以及协议本身是本书的主要内容。**

### 面向连接与无连接的服务
面向连接的服务(connection-oriented service)是按照电话系统建模的

与面向连接服务相对应的是无连接服务(conncetionless service)，这是按照邮政系统建 模的。每个报文(信件)都携带了完整的目标地址，每个报文都由系统中的中间节点路由， 而且路由独立于后续报文。报文(message)在不同的上下文中有不同的称呼;数据包/包 (packet)是网络层的报文。如果中间节点只能在收到报文的全部内容之后再将该报文发送给下一个节点，那么我们就称这种处理方式为存储-转发交换(store-and-forward switching)。 有别于此的另一种处理方式是在报文还没有被全部接收完毕之前就向下一个节点传输，这 种处理方式称为直通式交换(cut-through switching)。

不可靠(意味着没有被确认)的无连接服务通常称为数据报服务(datagram service)，它与电报服务非常类似，一般不会给发送方反馈任何确认消息。

有确认的数据报服务(acknowledged datagram service)就是为这些应用 提供的一类服务。这就像在寄挂号信时要求一个回执一样。当发送方收到回执时可绝对相 信这封信已经被送到对方手中，肯定没有在投递的途中丢失。手机上的文本消息就是一个 实例。

 
_使用不可靠连接的概念刚开始可能会令人感到疑惑不解。毕竟，为什么会有人愿意舍弃可靠通信而选择不可靠的通信呢?_

**首先，在给定的层次并不是总能使用可靠通信(可靠 通信的含义是指有确认)。例如，以太网并没有提供可靠通信。有些数据包可能偶尔会在传 输过程中被损坏，上层协议必须处理这个问题。尤其是，许多可靠服务是建立在不可靠数 据报服务之上的。其次，为了提供可靠服务而引入的固有延迟可能令人不可接受，特别在 诸如多媒体的实时应用中，更是无法忍受额外的延迟。由于这些原因，可靠通信和不可靠 通信将并存在任何一个网络中。**

### 服务与协议的关系
服务和协议是两个截然不同的概念，它们之间的区别非常重要。
#### 服务
服务是指某一层向它上一层提供的一组原语(操作)。服务定义了该层准备代表其 用户执行哪些操作，但是它并不涉及如何实现这些操作。服务与两层之间的接口有关，低层是服务提供者，而上层是服务用户。

#### 协议
与此不同的是，协议是一组规则，规定了同一层上对等实体之间所交换的数据包或者报文的格式和含义。对等实体利用协议来实现它们的服务定义，它们可以自由地改变协议，只要不改变呈现给它们用户的服务即可

==按照这种方式，服务和协议是完全相分离的==，这是任何一个网络设计者应该很好理解的关键概念。


## 参考模型
虽然与 OSI 模型相关的协议没 有被任何人所用，但实际上，该模型本身具有相当普遍意义，并仍然有效;它对讨论网络 体系结构中每一层的功能还是很重要。TCP/IP 协议模型则具有相反的特性:模型本身没有多大用处，但它的协议却已经广为流传。

### OSI参考模型
 OSI 模型有 7 层。适用于这 7 层的基本原则简要概括如下。 
1. 应该在需要一个不同抽象体的地方创建一层。 
2. 每一层都应该执行一个明确定义的功能。 
3. 每一层功能的选择应该向定义国际标准化协议的目标看齐。 
4. 层与层边界的选择应该使跨越接口的信息流最小。 
5. 层数应该足够多，保证不同的功能不会被混杂在同一层中，但同时层数又不能太多，以免体系结构变得过于庞大。

请注意，OSI 参考模型本身并不是一个网络体系结构，因为它并没有定义每一层的服务和所用的协议。它只是指明了每 一层应该做些什么事。然而，ISO 已经为所有层都制定了相应的标准，虽然这些标准并不 属于参考模型本身。

##### 物理层
物理层(physical layer)关注在一条通信信道上传输原始比特。
设计问题必须确保当一 方发送了比特 1 时，另一方收到的也是比特 1，而不是比特 0。


##### 数据链路层
数据链路层(data link layer)的主要任务是将一个原始的传输设施转变成一条没有漏 检传输错误的线路。

成数据帧传递 流量控制 控制对共享信道的访问（MAC子层）

##### 网络层
网络层(network layer)的主要功能是控制子网的运行
 一个关键的设计问题是如何将 数据包从源端路由到接收方。

拥塞控制

在广播式网络中，路由问题比较简单，所以网络层往往比较单薄，甚至根本不存在。

##### 传输层
传输层(transport layer)的基本功能是接收来自上一层的数据，在必要的时候把这些 数据分割成较小的单元，然后把这些数据单元传递给网络层，并且确保这些数据单元正确 地到达另一端。
 
而且，所有这些工作都必须高效率同时以一种上下隔离的方式完成，即随 着时间的推移导致底层硬件技术不可避免地发生改变时，对上面各层是透明的。

传输层是真正的端-端的层，它自始自终将数据从源端携带到接收方。换句话说，源机 器上的一个程序利用报文头和控制信息与目标机器上的一个类似程序进行会话。

_第 1 层到第 3 层是链式连接的，而第 4 层到第 7 层是端-端的_

##### 会话层
会话层(session layer)允许不同机器上的用户建立会话。会话通常提供各种服务，包 括对话控制(dialog control)(记录该由谁来传递数据)、令牌管理(token management)(禁 止双方同时执行同一个关键操作)，以及同步功能(synchronization)(在一个长传输过程中 设置一些断点，以便在系统崩溃之后还能恢复到崩溃前的状态继续运行)。

##### 表示层
表示层以下的各层最关注的是如何传递数据位，而表示层(presentation layer)关注的 是所传递信息的语法和语义

##### 应用层
应用层(application layer)包含了用户通常需要的各种各样的协议。
一个得到广泛使 用的应用协议是超文本传输协议(HTTP，HyperText Transfer Protocol)，它是万维网(WWW， World Wide Web)的基础。当浏览器需要一个 Web 页面时，它通过 HTTP 将所要页面的名 字发送给服务器，然后服务器将页面发回给浏览器。其他一些应用协议可用于文件传输、 电子邮件以及网络新闻等。

### TCP/IP参考模型

##### 链路层
所有这些要求导致本参考模型选择了数据包交换网络，它以一个可运行在不同网络之 上的无连接网络层为基础。模型中的最低层是链路层(link layer)，该层描述了链路必须完 成什么功能才能满足无连接的互联网络层的需求，比如串行线和经典以太网链路。这不是 真正意义上的一个层，而是主机与传输线路之间的一个接口

##### 互联网层
互联网层(internet layer)是将整个网络体系结构贯穿在一起的关键层

该层的任务是允许主机将数据包注入到任何网络，并且让 这些数据包独立地到达接收方(接收方可能在不同的网络上)。甚至数据包的到达顺序与它 们被发送的顺序不同，在这种情况下，如果需要按序递交数据，那么重新排列这些数据包 的任务由高层来负责完成

互联网层定义了官方的数据包格式和协议，该协议称为因特网协议(IP，Internet Protocol)，与之相伴的还有一个辅助协议，称为因特网控制报文协议(ICMP，Internet Control Message Protocol)。互联网层的任务是将 IP 分组投递到它们该去的地方。

##### 传输层
在TCP/IP模型中位于互联网层之上的那一层现在通常称为传输层(transport layer)。 

它的设计目标是允许源主机和目标主机上的对等实体进行对话，犹如 OSI 的传输层一样。 这里定义了两个端-端的传输协议。第一个是传输控制协议(TCP，Transport Control Protocol)，它是一个可靠的、面向连接的协议，允许从一台机器发出的字节流正确无误地 交付到互联网上的另一台机器。它把输入的字节流分割成离散的报文，并把每个报文传递 给互联网层。在目标机器，接收 TCP 进程把收到的报文重新装配到输出流中。TCP 还负责 处理流量控制，以便确保一个快速的发送方不会因发送太多的报文而淹没掉一个处理能力 跟不上的慢速接收方。

传输层的第二个协议是用户数据报协议(UDP，User Datagram Protocol)，它是一个不 可靠的、无连接协议，适用于那些不想要 TCP 的有序性或流量控制功能，而宁可自己提供 这些功能的应用程序

##### 应用层
TCP/IP 模型并没有会话层和表示层，因为当时感觉并不需要这两层。相反，应用层简 单包含了所需的任何会话和表示功能。来自 OSI 模型的经验已经证明这种观点是正确的: 对于大多数应用来说这两层并没有多大用处。

### 两种参考模型的比较
OSI 和 TCP/IP 参考模型有很多共同点。两者都以协议栈概念为基础，并且协议栈中的 协议彼此相互独立。除此之外，两个模型中各个层的功能也大致相似。例如，在两个模型 中，传输层以及传输层以上各层都为希望通信的进程提供了一种端-端的独立于网络的传输 服务。这些层组成了传输服务提供者。而且，在这两个模型中，传输层之上的各层都是传 输服务的用户，并且是面向应用的。

**OSI模型核心：服务，接口，协议**

OSI 模型的最大贡献在于明确区分了这 3 个概念。每一层都为它的上一层执行某 些服务。服务定义说明了该层是做什么的，而不是上一层实体如何访问这一层，或这一层 是如何工作的。它定义了这一层的语义。

每一层的接口告诉它上面的进程如何访问本层。它规定了有哪些参数，以及结果是什
么。但它没有说明本层内部是如何工作。

>这些思想与现代面向对象的程序设计思想非常吻合。一个对象就如同一个层一样，它
有一组方法(或者称为操作)供对象之外的过程调用。这些方法的语义定义了该对象所提
供的服务集合。方法的参数和结果构成了对象的接口。对象的内部代码是它的协议，对于
外部而言是不可见的，也不需要被外界关心。

- OSI模型中：网络层提供面向连接/无连接的服务，但传输层仅支持面向连接
- TCP/IP模型中：网络层仅支持无连接服务，但传输层支持有连接与无连接两种服务。即TCP与UDP

**数据链路层提供流量控制功能，不具有拥塞控制功能。拥塞控制仅由网络层+传输层提供。**


## 网络实例
### 因特网
因特网(Internet)并不是单个网络，而是大量不同网络的集合

---
## 小结
- 协议栈与网络体系结构
- 服务和协议的概念
- OSI与TCP参考模型
- 参考模型间的比较
- 简单的网络实例

> 网络软件由网络协议组成，而协议是进程通信必须遵守的规则。大多数网络支持协议 的层次结构，每一层向它的上一层提供服务，同时屏蔽掉较低层使用的协议细节。协议栈 通常基于 OSI 模型或者 TCP/IP 模型。这两个模型都有链路层、网络层、传输层和应用层，但它们在其他层不同。设计问题包括可靠性、资源分配、规模增长、信息安全等。这本书的大部分内容主要处理网络协议和相应的设计问题。

> 网络为它们的用户提供不同的服务。服务的范围从无连接的尽力而为数据包传递服务
到面向连接的有质量保证服务。在某些网络中，无连接服务由某一层提供，而面向连接的
服务则由它上面的层提供。

---
## Q&As

- 使用协议栈的原因？

- 协议栈的定义？

- 虚线实线代表啥？[ans](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=38)

- 可靠的代表什么？[ans](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=41)

- 为什么要用不可靠连接？

