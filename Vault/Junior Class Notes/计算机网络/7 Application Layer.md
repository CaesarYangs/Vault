# Applicaiton Layer

## [DNS域名系统](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=484)

-   DNS 的本质是发明了一种层次的、基于域的命名方案，并且用一个分布式数据库系统 加以实现。 DNS 的主要用途是将主机名映射成 IP 地址，但它也可以用于其他用途。 RFC 1034、 1035、 2181 给出了 DNS 的定义，后来其他文档对它又做了进一步的阐述。

### [DNS Name Space名字空间](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=485)

-   对于 Internet，命名层次结构的顶级由一个专门组织负责管理。该组织名为 Internet 字与数字地址分配机构 CICANN, Internet Corporation for Assigned Names and Numbers), 创建于 1998年，它是 Internet成长为全球性并且受到经济关注的部分成熟标志。从概念上 讲， Internet被划分为超过 250 个顶级域名( top-level domains)，其中每个域涵盖了许多 机。这些域又被进一步划分成子域，这些子域可被再次划分，依此类推。所有这些域可以 表示为 一棵树，如图 7-1 所示。树的叶子代表没有子域的域(当然要包含机器)。一个叶结 点域可能包含一台主机，或者代表一个公司，该公司包含数以千计的主机。

### [域名资源记录](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=487)
- 无论是只有一台主机的域还是顶级域，每个域都有一组与它相关联的资源记录 (resource record)。这些记录组成了 DNS 数据库。对于一台主机来说，最常见的资源记录 就是它的 IP 地址，但除此以外还存在着许多其他种类的资源记录。
-  ==DNS 基本功能是将域名映射到资源记录。==

### [域名服务器](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=490)

-   为了避免由于单个信息源带来的各种问题， DNS 名字空间被划分为一些不重叠的区域 (zones)。针对图 7-1 的名字空间，一种可能的划分方法如图 7-5 所示。每个圈起来的区域 包含域名树的一部分。

[查询过程](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=491)

-   查询一个名字和找出其对应地址的过程称为域名解析( name resolution)
    
-   一个权威记录( authoritative record)由管理该记录的权威部门提供，因此总是 正确的。权威记录的权威性是相对缓存记录( cachedrecord)而言的，缓存的记录有可能过 时了。

[远端查询概念](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=492)

-   有关这种长距离远程查询的场景，有 3 个技术要点值得讨论。首先，在图 7-6 中两个 不同的查询机制在工作。当主机 flits.cs.vu.nl 将查询发送给本地域名服务器后，该域名服务 器就代替该主机处理域名解析工作，直到它返回所需的答案。这里的答案必须是完整的， 它不能返回部分答案。虽然部分答案可能也会有所帮助，但不是查询应该得到的结果。这 个机制称为递归查询( recursive query)。
    
-   另一方面，根域名服务器(和每个后续的域名服务器)并不是递归继续查询本地域名 服务器。它只是返回一个部分答案，并移动到下一个查询操作。本地域名服务器负责继续 解析，具体做法是发出进一步的查询报文。这个机制称为迭代查询( iterative query)。 迭代查询是一个逐步求精的过程
    
-   它必须知道 edu 域的域名服务器，因为 cs.washington.edu属于 edu域管辖下。在第 步，它返回查询的答案，其中包括了名字和 IP地址。
    
-   一次域名解析可以涉及这两种机制，如同该例子所表明的那样。
    
-   值得讨论的第二点是缓存
    
-   这种使用缓存答案的做法可大大降低一次 查询的步骤，并能提高查询性能。

[Page 480](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=493)

-   然而，高速缓存的答案不具权威性，因为在 cs.washington.edu 所做的信息变化将不会 传播到世界上所有可能知道它的缓存。出于这个原因，缓存的表项不应该生存得太长。这 就是为什么在每条资源记录中要包含 Time to live 字段的原因。
    
-    第三个讨论的问题关于查询和响应使用的传输层协议。域名系统采用的是 UDP。 DNS消息通过 UDP 数据包发送，格式非常简单，只有查询和响应:域名服务器可用此数据包继续进行解析操作。 

## [万维网](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=512)

-   Web 是万维网( World Wide Web·)的俗称，它是一个体系结构框架。该框架把分布在 整个 Internet 数百万台机器上的内容链接起来供人们访问。

## [体系结构概述](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=513)

-   超丈本( hypertext) 所指向的页面。这个过程可无限地重复下去。让一个页面指向另一个页面的想法现在称为 Clink)，这些页面可以分布在全球任何地方。用户单击一个链接就可以跟随这个链接来到它 (Web page)或简称为页面( page)的形式表示。每个页面可以包含指向其他页面的链接 站在用户的角度看， Web 由大量分布在全球范围的内容组成，这些内容以 Web 页面

[Page 501](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=514)

-   抓取网页所用的“请求.响应”协议是一个简单的基于文本协议，它运行 TCP 之上，就像 SMTP 一样。
    
-   这个协议就是所谓的超文本传输协议( HTTP, HyperText Transfer Protocol )。内容可能只是一个磁盘读取的文档，或者是数据库查询和程序执行的结 果。如果每次显示的是相同的一个文档，则称该网页为静态页面(static page)。相反，如 果每次显示的是程序按需产生的内容，或者页面本身包含了一个程序，则称该网页为动态 页面 Cd归缸nic page)。

[URL](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=515)

-   选择的解决方案是用一种能同时解决上述 3 个问题的方式来标识页面。每个页面 被分配一个统一资源定位符(URL, UniformResourceLocator)，用来有效地充当该页面在 全球范围内的名字。

[服务器端](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=519)

-   关于客户端的介绍己经很多了，现在让我们来看看服务器端。正如我们在前面所看到 的，当用户键入一个 URL 或者单击一行超文本时，浏览器会解析 URL，并且将 http://和下 一个斜线之间的那部分解释成待查找的 DNS 名字。有了服务器的 IP 地址以后，浏览器与 该服务器的端口 80 建立一个 TCP 连接:然后它发送一条命令，其中包含了 URL 的剩余部 分，即该服务器上某个页面的路径:最后服务器返回该页面供浏览器显示。

[静态web页面](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=525)

-   HTML一一超文本标记语言
    
-   相对于其他无显式标记的语言来说，标记语言的关键优点是将内容与其应该如何表示 相分离。

[HTTP](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=542)

-   ==HTTP是一个简单的请求.响应协议，它通常运行在 TCP之上。==它指定了客户端可能发 送给服务器什么样的消息以及得到什么样的响应。
    
-   浏览器与服务器联系最常用的方法是与服务器机器上的端口 80 建立一个 TCP 连接， 虽然这个过程并不是正式要求的。使用 TCP 的意义在于浏览器和服务器都不需要担心如何 处理长消息、可靠性或拥塞控制。所有这些事情都由 TCP 实现负责处理。
    
-   这种现象导致了 HTTP 1.1 的诞生，它支持持续连接句ersistentconnection)。有了这种 连接，就有可能建立一个 TCP连接，在其上发送一个请求并得到一个响应，然后再发送额 外的请求井得到额外的响应。这种策略也称为连接重用 Cconnection reuse)
    
-   在图 7-36(b)中，通过一个持续连接来获取页面。也就是说， TCP 连接在启动后是开放 的，然后发送相同的 3 个请求，一个接着一个，后一个跟前一个一样，然后才关闭连接。 可以观察到页面的提取任务更快速地完成了。加速的原因有两个=首先，时间没有浪费在建立更多的连接上。每个 TCP 连接至少需要一个往返时间才能建立:其次，相同图像的传 输更加迅速。为什么会这样?这是因为 TCP 的拥塞控制。在一个连接的开始阶段， TCP 使 用慢启动过程来增加吞吐量，直到它了解网络路径的行为。这个预热期的后果是多个短 TCP 连接比一个长 TCP 连接传输信息所需的时间更长。

-  然而，持续连接不是免费的。一个新的问题出现了，那就是什么时候关闭连接。一个 到服务器的连接在页面加载时应该保持开放。然后呢?对于用户来说有个很好的机会，他 可以点击一个链接从服务器请求另一个页面。如果连接保持打开状态，那么下一个请求被 立即发送出去。不过，谁也不能保证任意时间后客户将向服务器发出另一个请求。实际上， 客户机和服务器通常将持续连接保持打开状态，直到它们己经闲置一小段时间(例如 60 秒)，或者它们己经打开了大量的连接必须要关闭一些。

[方法](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=544)

-   操作一一称为方法( method)。这种通用性是 SOAP 得以存在的主要原因。
    
-   GET 方法请求服务器发送页面(在大多数情况下，当我们说“页面”时我们指的是“对 象”，但是把一个页面想象成一个文件，理解这个概念就足够了〉。该页面被适当编码成 MIME。大部分发送给 Web 服务器的请求都是 GET 方法。 GET 的通用形式是:

[缓存](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=547)

-   积攒已经获取的网页供日后使用的处理方式称为缓存( caching)。其优点是当缓存的 页面被重复使用时，没有必要进行重复传输。
    
-   找到没有过期的页面是使用缓存的最大收益，因为这意味着根本不需要联系服务器。 不幸的是，它并不总是能工作得很好。服务器必须谨慎地使用 Expires头，因为它们可能无 法确定一个页面何时将被更新。

## [内容分发](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=581)
    
-   一种体系结构就是内容分发网络(CDN, Content Distribution Network)。采用这种体 系结构，内容提供商在 Internet 的某些位置建立一组分布式机器，然后通过它们给客户提 供内容.这是大牌球员的选择。另 一种体系结构是对等网络( P2P , Peer-to-Peer).采用这 种体系结构， 一组计算机把它们的资源集中起来，彼此互相服务提供内容，无须单独配置 服务器或者任何中央控制节点。这种想法抓住了人们的想象力，因为通过共同努力一致行 动，许多小球员可以团结起来形成一股巨大的冲击力。

### [服务器农场和web代理](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=584)

-   到目前为止我们看到的 Web 设计都只有一个单独的服务器，这台机器和多个客户端机 器交谈。为了构建大型 Web 站点并且运行性能良好，我们可以加快服务器端的处理或者客 户端的处理。在服务器端，用更强大的 Web 服务器建设成一个服务器农场，这里用一个计 算机集群替代单个的服务器为客户提供服务。在客户端，可以通过更好的缓存技术来实现 更好的性能。尤其是，代理缓存为一组客户提供了大容量的共享缓存。
    
-   服务器农场 无论一台机器的带宽多大，在超负荷之前它也只能为一定数量的 Web 请求服务。这种 情况的解决方案是使用多台计算机来充当 Web 服务器。这个想法导致了如图 7-65 所示的 服务器农场模型的诞生。

[Page 572](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=585)

-   在更通用的设计中，前端可以检查数据包的 IP、 TCP 和 HTTP 头，并任意地将它们映 射到服务器。这种映射称为负载均衡( load balancing)策略，因为目标是为了均衡服务器 的工作负载。这
    
-   在这种情况下的前 端设备是一个交换机或路由器，但它根据传输层或更高层次的信息采取相应的行动。这样 的盒子称为中间件盒( middlebox)，因为它把自己插入到一条网络路径的中间，而根据协 议挠的规定它是没有这项业务的。在这种情况下，前端设备最好考虑作为服务器农场内部 的一部分，将所有层次都终结到应用层(因此可以使用所有这些层的头信息〉。

[代理](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=586)

-   这种设置如图 7-66所示。为了使用代理，每个浏览器必须配置成向代理而不是页面的 真实服务器发出页面请求。如果代理有相应的页面，它就立刻返回页面。如果它没有，它 就从服务器获取页面，并将它添加到缓存以备将来使用，同时返回给请求该页面的客户。 除了向代理而不是真正服务器发送 Web 请求外，客户还要用它的浏览器高速缓存来执 行它们自己的缓存。只有在浏览器尝试以自己的高速缓存页面无法满足请求之后，才会咨 询代理。也就是说，代理提供了一个第二级的缓存。

### [CDN](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=587)

-   内容分发网络
    
-   内容分发网络( CON, Content Delivery Network)彻底扭转了传统的 Web 缓存想法。 与客户在附近的缓存中寻找请求的页面副本不同， CON 为客户提供了这样的信息:在一组 分布在不同地点的节点中哪个节点拥有所请求页面的副本，并且指示客户端使用附近的节 点作为服务器。
    
-   使用树结构有 3 个好处。首先，内容的分发具备可扩展性。随着越来越多的客户需要， 可以使用更多的 CON 节点:而且当在 CON 节点之间分发变成瓶颈时，可以采用更多的树 层次。不管有多少客户，树结构总是有效的。源服务器不会超载，因为它通过 CON 节点

 [CDN分发树](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=588)

-   树和许多客户交谈:而它自己不需要应答每个页面请求。其次，每个客户都享有不错的性 能，因为他是从附近的服务器而不是一个遥远的服务器那里获取页面。这是因为建立连接 所需要的往返时间较短，而往返时间越短 TCP 慢启动得更快，而且较短的网络路径经过 Internet 上拥塞区域的可能性较小。最后，放置在网络上的总负荷也保持在最低水平。如果 CDN 节点都放置在恰当的位置，一个给定页面的流量应该恰好通过网络中各个部分一次。 这点非常重要，最终总会有人要为网络带宽付费。
    
-   的客户端 F 地址返回不同的查询结果。答案将是最靠近客户端的 CDN 节点的 IP 地址。 务器同时作为 CDN 节点运行。它不是为每个请求返回相同的 IP 地址，而是根据发出请求 名服务器联系，请求它解析 www.cdn.como 现在到了真正展示聪明才智的地方。该域名服 式进行。通过使用 DNS 协议，浏览器了解到 cdn.com 域名服务器的 IP 地址，然后与该域 页面，浏览器将使用 DNS 把 www.cdn.com 解析为一个 IP 地址。 DNS 查找过程以通常的方 redirection)。假设一个客户要获取 URL为问:ρ阴阳也com/page.html 的页面。为了提取 第三种方法克服了前两种方法的困难，使用了 DNS 技术，因而称为 DNS 重定向( DNS

## [对等网络](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=591)

-   不是每个人都能在世界各地设立 1000 个节点的 CDN 来分发他们的内容(实际上，租 1000 台分布在全球各地的虚拟机并不是很难，因为有一个发展良好并且有竞争力的托管 行业:但是，建立一个 CDN 仅仅是获得节点的开始)。幸运的是，对于其他人，还有一个 替代品可用。它简单易用，并且可以分发大量的内容。它就是对等网络( P2P, Peer-to-Peer)

## [小结](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=599)

-   需要一个更为复杂和动态的命名方案。现在使用的是 一个称为域名系统的分层计划。它将 Internet 上的机器组织成一组树。在顶层 ， 是众所周 知的通用域名，包括 com、 edu 以及约 200 个国家或地区的顶级域名。 DNS 作为 一个分布 式数据库，其服务器遍布在世界各地。通过查询 DNS 服务器，一个进程可以将 Internet 域名映射成 E 地址，该地址被用来与该域的计算机通信。
    
-   Web 是被大多数人认为等同于 Internet 的应用程序。最初，它只是一个系统，用来无 缝连接跨计算机的超文本页面(以 HTML 语言编写〉。浏览器与服务器建立一个 TCP 连接 并使用 HTTP 下载网页。如今，许多 Web 上的内容是动态生成的，无论是在服务器端(例 如， PHP)，或在浏览器中〈例如，使用 JavaScript)。当与后端数据库相结合时，动态服务 器页面催生出这样的 Web 应用程序，比如电子商务和搜索等。动态浏览器页面正在演变为 全功能的应用，比如电子邮件，这些全功能应用运行在浏览器内，使用 Web协议与远程服 务器通信。
    
-   缓存和持续连接是被广泛用来提高 Web 性能的两种技术。尽管移动电话的带宽和处理 能力都有了很大的增长，但在移动设备上使用 Web独具挑战性。 Web站点通常给带有小屏 幕的设备发送页面的裁剪版本，这样的页面具有较小图像和较少复杂的导航。
    
-   盛极一时的网站数量只有一小部分，而数量巨大的网站又没那么流行。为了满足流行 的网站的需求，已经部署了内容分发网络。 CDN 使用 DNS 把客户指向一个附近的服务器: 服务器放置在世界各地的数据中心。另外， P2P网络让一组机器彼此共享内容，比如电影。 它们提供的内容分发能力可随着凹P 网络的机器数量的不断增大而获得提升，而且可与最 大的网站相媲美。