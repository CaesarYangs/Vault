# Medium Access Control Sublayer

广播

## [引言](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=212)

-   网络链路可以分成两大类 z 使用点到点连接和使用广播信道。我们在第 2 章学习了点 到点链路，本章将讨论广播网络和相应的协议。
    
-   用来确定多路访问信道下一个使用者的协议属于数据链路层的一个子层，该层称为介 质访问控制( MAC, Medium Access Control)子层。在 LAN 中， MAC 子层显得尤为重要， 特别是在无线局域网中，因为无线本质上就是广播信道。

- 相反， WAN 则使用点到点链路， 当然，卫星网络除外。因为多路访问信道和 LAN 如此紧密相关，所以，在本章我们将从总 体上讨论 LAN，其中也包括一些从严格意义上讲并不属于 MAC 子层的内容，但是总的主 题还是关于信道控制。

- ==技术上， MAC 子层位于数据链路层底部==

- LAN WAN

## [4.1 信道分配问题](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=212)

### 4.1.1 静态信道分配
-   在多个竞争用户之间分配单个信道的传统做法是把信道容量拆开分给多个用户使用，

### [4.1.2 动态信道分配](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=214)

-   既然所有的传统静态信道分配方法都不适应突发性的流量，我们现在就来研究动态的 信道分配方法。

- **信道分配的五个关键假设：**
    
-   1 )流量独立( independent traffic )。该模型是由 N 个独立的站(比如计算机、电话) 组成的，每个站都有一个程序或者用户产生要传输的帧。在长度为 Lit 的间隔内，期望产生 的帧数是 λLit，这里 λ 为常数(新帧的到达率)。一旦生成出一帧，则站就被阻塞，直到该 帧被成功地发送出去。
    
-   2)单信道 CSingle Channel)。所有的通信都用这一个信道。所有的站可以在该信道 上传输数据，也可以从该信道接收数据。所有站的能力都相同，尽管协议可能为站分配不 同的角色(比如，优先级)。
    
-   (3)冲突可观察 CobservableCollision)。如果两帧同时传输，则它们在时间上就重叠， 由此产生的信号是混乱的，这种情况称为冲突( collision)。所有的站都能够检测到冲突事 件的发生。冲突的帧必须在以后再次被发送。除了因冲突而产生错误外，不会再有其他的 错误。
    
-   4)时间连续或分槽( Continuous or slo time)。时间可以假设是连续的，即在任何 时刻都可以开始传输帧。另一种选择是把时间分槽或者分成离散的间隔(称为时间槽)。帧 的传输只能从某个时间槽的起始点开始。一个时间槽可能包含 0、 l 或者多个帧，分别对应 于空闲的时间槽、一次成功发送，或者一次冲突。
    
-   5)载波侦昕或不昕( Carrier Sense or no carrier sense)。有了载波侦昕的假设，一个站 在试图用信道之前就能知道该信道当前是否正被使用。如果信道侦昕结果是忙，则没有一 个站会再去试图使用该信道。如果没有载波侦昕，站就无法在使用信道之前侦昕信道，它 们只能盲目地传输，以后再判断这次传输是否成功。

---
  具体CSMA的工作机制关联着我们之前所叙述的三种CSMA模式，以下我们分别进行叙述：

-   1-persistentes CSMA：“**节点需要持续监听信道，一旦节点发现信道空闲后，则立刻发送数据。**”。  
    
-   0-persistentes CSMA：“**节点不连续监听信道，若该时刻节点监听信道为busy，那么等待一段时间后，再次进行监听。若节点该时刻监听信道为空闲，则立刻发送数据。**”  
    
-   p-persistentes CSMA：“**节点需要持续监听信道，一旦发现信道空闲后，节点以p的概率立刻发送数据，以1-p的概率不发送数据。若节点该时刻不发送数据，那么等待一段时间后，再次进行监听，并以p概率再次发送**”。（_注：这里所述的p概率可以理解成抛骰子赌大小，如果抛大，那么就发送，反之不发送。其中抛大的概率就是p，而抛小的概率就是1-p_）
---

## [4.2 多路访问协议（算法）](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=215)

### ALOHA
-   我们在这里将要讨论两个版本的 ALOHA:纯 ALOHA 和分槽 ALOHA。它们的区别在 于时间是连续的，那就是纯粹版的 ALOHA;或者时间分成离散槽

[Page 203](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=216)

-   **纯ALOHA**
-    *ALOHA 系统的基本思想非常简单:当用户有数据需要发送时就传输。当然，这样做 可能会产生冲突，冲突的帧将被损坏。*
    
-   如果帧被损坏了，则发送方要等待*一段随机时间*，然后再次发送该帧。等待的时间必 须是随机的，否则同样的帧会一次又一次地冲突，因为冲突帧被重发的节奏完全一致。如 果系统中多个用户共享同一个信道的方法会导致冲突，则这样的系统称为竞争( contention) 系统。
    
-   *我们使所有的帧具有同样的长度*， 因为对于 ALOHA 系统，采用统一长度的帧比长度可变的帧更能达到最大的吞吐量。
    
-   无论何时，只要两个帧在相同时间试图占用信道，冲突就会发生(如图 4-1 所示)，并 且两帧都会被破坏。如果新帧的第一位与几乎快传完的前一帧的最后一位重叠，则这两帧 都将被彻底毁坏(即具有不正确的校验和)，稍后都必须被重传。校验和不可能(也不应该) 区分出是完全损坏还是局部差错。坏了就是坏了。

### [分槽ALOHA](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=217)

-   分槽 ALOHA ALOHA 出现不久， Roberts 发表了 ==一种能将 ALOHA 系统的容量增加一倍的方法 ==。他的建议是将时间分成离散的间隔，这种时间间隔称为时间槽( slot), 每个时间槽对应于一帧。这种方法要求用户遵守统一的时间槽边界。取得同步时间的一种 办法是由一个特殊的站在每个间隔起始时发出一个脉冲信号，就好像一个时钟一样。

[分槽ALOHA详细解释](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=218)

-   Roberts 方法称为分槽 ALOHA (slotted ALOHA)。与纯 ALOHA 不同的是，在分槽 ALOHA 中，站不允许用户每次敲入回车键就立即发送帧。相反，它必须要等到下一个时 槽的开始时刻。因此，连续的纯 ALOHA 变成了离散的 ALOHA，这将易受冲突期减小了 一半。

### [载波侦听多路访问协议](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=219)

目的是为了提高ALOHA协议的性能

-   利用分槽 ALOHA，可以达到的最佳信道利用率是 1/e。这么低的结果并不令人惊奇， 因为每个站都可以随意地发送数据，它并不知道其他站是否也在发送数据。所以，频繁地 发生冲突是难免的。然而，在局域网中，站是完全有可能检测到其他站当前在做什么，然 后再根据情况调整自己的行为。这些网络可以获得比 lie好得多的利用率。在这一小节中， 我们将讨论一些提高性能的协议。

-   如果在一个协议中，站监昕是否存在载波(即是否有传输)，并据此采取相应的动作， 则这样的协议称为载波侦昕协议( carriersense protocol)。很久以前许多这类协议就被提了 出来，

#### **坚持和非坚持CSMA**
-   坚持和非坚持 CSMA 我们将要学习的第一个载波侦昕协议称为 1-坚持载波检测多路访问 （CSMA, Carrier Sense Multiple Access)。这是最简单的 CSMA 方案。当一个站有数据要发送时，它首先侦 昕信道，确定当时是否有其他站正在传输数据:如果信道空闲，它就发送数据。否则，如 果信道忙，该站等待直至信道变成空闲:然后，站发送一帧。如果发生冲突，该站等待一 段随机的时间，然后再从头开始上述过程。*这样的协议之所以称为 1-坚持，是因为当站发 现信道空闲时，它传输数据的概率为 1*——贪婪
    
-   第二个载波侦昕协议是非坚持 CSMA (nonpersistent CSMA)。在这个协议中，站在试 图发送数据之前要理智得多，不像前一个协议那样贪婪。和前一个协议一样，站在发送数 据之前要先侦昕信道。如果没有其他站在发送数据，则该站自己开始发送数据。然而，如 果信道当前正在使用中，则该站并不持续对信道进行监听，以便传输结束后立即抓住机会 发送数据。相反，*它会等待一段随机时间，然后重复上述算法。因此，该算法将会导致更好的信道利用率，但是比起 1一坚持 CSMA，也带来了更大的延迟。*

 #### [带冲突检测的CSMA](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=220)
    
-   这种协议称为带冲突检测的 CSMA CSMA/CD, CSMA with Collision Detection)。==它是经典以太局域网的基础==
    
-   如同许多其他LAN协议一样， CSMA/CD也使用了图4-5所示的概念模型。在标记为 句点，一个站己经完成了帧的传送，其他需要发送帧的站现在可以试图发送了。如果有两 个或者多个站同时进行传送，冲突就会发生。如果一个站检测到冲突，它立即中止自己的 传送，等待一段随机时间，然后再重新尝试传送(假定在此期间没有其他站己经开始传送〉。

- *因此，我们的 CSMA/CD 模型将由交替出现的竞争期、传输期，以及当所有站都育事止的空闲期〈比如没有传输任务〉组成。*

      
- **有了这种认识，我们可以把 CSMA/CD 竞争看成是一个分槽 ALOHA 系统，时间槽宽 度为2τ。**
-  CSMA/CD和分槽ALOHA的区别在于， 只有一个站能用来传输的时间槽(即信道被抓住了)后面紧跟的那些时间槽被用来传输该 帧的其余部分。如果帧时相比传播时间长很多，这种差异将能大大提高协议的性能。

- 此方案要求设备在发送帧的同时要对信道进行侦听，以确定是否发生碰撞，若在发送数据过程中检测到碰撞，则进行如下碰撞处理操作

### [无冲突协议](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=221)

- 位图协议
- 令牌传递


### [无线局域网协议](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=227)
[Page 215](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=228)
-   我们需要一个 MAC 协议，它能防止这种冲突的发生，因为冲 突将导致带宽的浪费。由于竞争者离得太远而导致站无法检测到潜在的竞争者，这个问题 称为隐藏终端问题( hidden station problem)。
    
-   我们需要一个 MAC 协议， 它能防止此类延迟传输的发生。这个问题称为暴露终端问题( exposed station problem)。
    
-   MACA 的基本思想是 发送方剌激接收方输出一个短帧，以便其附近的站能检测到该次传输，从而避免在接下去 进行的(较大)数据帧传输中也发送数据。这项技术被用来替代载波侦听。

## [4.3 以太网](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=229)

-   我们将开始研究太网网实际系统，这可能是现实世界中最普遍的一种计算机网络。 以太网有两类:第一类是经典以太网( classicEhemet)，它使用我们在本章己学过的技术 解决了多路访问问题:第二类是交换式以太网( switchedEthernet)，使用了一种称为交换 机的设备连接不同的计算机。

**[以太网传输过程中的内容](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=232)**

-   为了更加容易地区分有效帧和垃圾数据， 以太网要求有效帧必须至少 64字节长，从目标地址算起直到校验和，包括这两个字段本身 在内。如果帧的数据部分少于 46 个字节，则使用填充( Pad)字段来填充该帧，使其达到 最小长度要求。
    
-   限制最小帧长的另一个(也是更重要的〉理由是避免出现这样的情况:当一个短帧还 没有到达电缆远端的发送方，该帧的传送就已经结束:而在电缆的远端，该帧可能与另一 帧发生冲突

- **如果一个站试图传送非常短的帧，则可以想象:虽然发生了冲突，但是在突发噪声回 到发送方( 2τ)之前，传送已经结束。然后，发送方将会得出刚才一帧已经成功发迭的错 误结论。为了避免发生这样的情况，所有帧必须至少需要 2τ 时间才能完成发送，这样当突 发噪声回到发送方时传送过程仍在进行。**

[二进制指数后退的 CSMA/CD](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=233)
-   经典以太网使用 1-坚持 CSMA/CD 算法，我们在 4.2 节对此有所描述。这个算法意味 着当站有帧需要发送时要侦昕介质， 一旦介质变为空闲便立即发送。在它们发送的同时监 测信道上是否有冲突。如果有冲突，则立即中止传输，并发出一个短冲突加强信号，在等 待一段随机时间后重发。
    
-   如果一个站试图传送非常短的帧，则可以想象:虽然发生了冲突，但是在突发噪 到发送方( 2τ)之前，传送已经结束。然后，发送方将会得出刚才一帧已经成功发迭的错 误结论。为了避免发生这样的情况，所有帧必须至少需要 2τ 时间才能完成发送，这样当突 发噪声回到发送方时传送过程仍在进行。

###  [交换以太网](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=236)

-   幸运的是，还有另一条出路可以处理不断增长的负载:即交换式以太网。这种系统的 核心是一个交换机( switch)，它包含一块连接所有端口的高速背板，如图 4-17 (b)所示。 从外面看，交换机很像集线器。它们都是一个盒子，通常拥有 48 个端口，每个端口都 有一个标准的 RJ-45 连接器用来连接双绞线电缆。
    
-   在这点上，交换机再一 次体现了与集线器的不同。在集线器中，所有站都位于同一个冲突域 Ccollision domain), 它们必须使用 CSMNCD 算法来调度各自的传输。在交换机中，每个端口有自己独立的冲 突域。通常情况下，电缆是全双工的，站和端口可以同时往电缆上发送帧，根本无须担心 其他站或者端口。现在冲突不可能发生，因而 CSMNCD 也就不需要了。然后，如果电缆 是半双工的，则站和端口必须以通常的 CSMNCD方式竞争传输。

## [4.4 无线局域网](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=244)

-   另一种模式，如图 4-23 (b)所示，是一种自组织网络( ad hoc network)。这种模式下 的网络由一组相互关联的计算机组成，它们相互之间可以直接向对方发送帧。这里没有接 入点。

### [802.11 协议栈](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=245)

-   在 802.11 中，介质访 控制( MAC, Medium Access Control) 子层决定如何分配信道，也就是说下一个谁可以 送。在它上方的是逻辑链路控制( LLC, Logical Link Control) 子层，它的工作是隐藏 802 系列协议之间的差异，使它们在网络层看来并无差别。
    
-   基于正交频分复用( OFDM, Orthogonal Frequency Division Multiplexing)编码方案的新传输技术分别在 1999 年和 2003 年被引入进 来，我们在 2.5.3节介绍过 OFDM。首先是 802.lla，它使用了 SGHz这个不同的频段:第 802.llg，它坚守在 2.4 GHz，并保持兼容性。两者都提供高达 54Mbps 的数据率。

### [802.11 MAC 子层协议](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=247)

此种方案采用主动避免碰撞而非被动侦测的方式来解决碰撞问题。可以满足那些不易准确侦测是否有碰撞发生的需求，如无线网域。

-   相反， 802.11 试图避免冲突，采用的协议称为带有冲突避免的 CSMA CCSMA/CA, CSMA with Collision Avoidance)
    
-   在 OFDM 物理层 情况下，后退选择的时间槽数范围在 15 之间。该站将等待，直到信道处于闲置状态。 具体做法是 z 通过侦昕确定在一个很短的时间内(这段时间称为 DIFS，我们在下面解释) 没有信号:然后倒计数空闲时间槽，当有帧在发送时暂停该计数器:当计数器递减到 o, 该站就发送自己的帧。如果帧发送成功，目标站立即发送一个短确认。如果没有收到确认， 则可推断出传输发生了错误，无论是冲突或是其他什么错。在这种情况下，发送方要加倍 后退选择的时间槽数，再重新试图发送。如此反复，连续像以太网那样以指数后退，直到 成功发送帧或达到重传的最大次数。

- **该协议在概念上类似于以太网的 CSMA/CD，在发送前侦 昕信道和检测到冲突后指数后退。然而，需要发送帧的站必须以随机后退开始(除非它最 近没有用过信道，并且信道处于空闲状态)，而且它不等待冲突的发生。**

[CSMA/CA图示解释](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=249)

-   为了减少究竟哪个站在发送的模糊不清， 802.11 定义信道侦听包括物理侦听和虚拟侦 昕两部分。物理侦昕只是简单地检查介质，看是否存在有效的信号:有了虚拟侦昕，每个 站可以保留一个信道何时要用的逻辑记录，这是通过跟踪网络分配向量( NAV, Network Allocation Vector)获得的。每个帧携带一个 NAV 宇段，说明这个帧所属的一系列数据将 传输多长时间。无意中听到这个帧的站就知道无论自己是否能够侦听到物理信号，由 NAV 所指出的时间段信道一定是繁忙的。例如，一个数据帧的 NAV 给出了发送一个确认所需要 的时间。所有听到该数据帧的站将在发送确认期间推迟发送，而不管它们是否能昕到确认 的发送。

### [802.11帧结构](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=252)

-   802.11 标准定义了空中三种不同类型的帧:数据帧、控制帧和管理帧。每一种帧都有 一个头，包含了与 MAC 子层相关的各种字段。除此以外，还有一些头被物理层使用，这 些头绝大多数被用来处理传输所涉及的调制技术，所以这里我们不讨论它们。 数据帧的格式如图 4-29 所示。首先是帧控制 （Frame Control)字段。它本身

## [4.8 数据链路层交换](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=269)

-   当我们采用称为网桥( bridge)的设备来连 接这些局域网就可以做到这一点。我们在 4.3.4节描述的以太网交换机是网桥的现代名称: 它们提供的功能超越了传统的以太网和以太网集线器，可以很容易地把多个局域网加入到 一个更大更快的网络上。我们将交替着使用术语“网桥”和“交换机。

#### [Hub 网桥交换机 路由 网关](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=276)

## [小结](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=283)

-   许多动态信道分配算法被设计了出来。 ALOHA 协议，包括分槽的与不分槽的，被用 在许多实际系统的衍生物中，例如线缆调制解调器和盯ID。当可以侦听信道状态后，作为 一种改进，站在其他站传输时可避免启动自己的传输。这种技术，即载波侦听，导致了局 域网和城域网的 CSMA 各种协议。它是典型以太网和 802.11 网络的基础。
    
-   无线局域网提出了新的问题，就是很难侦听到传输冲突，而且站所覆盖的区域可能有 所不同。在主宰无线局域网的 IEEE 802.11 中，站使用 CSMA/CA，通过留有很小的时间间 隔来避免冲突，从而减轻第一个问题。站还可以使用 RTS/CTS 协议来对抗由于第二个问题 引起的隐藏终端。
    
-   以太网是有线局域网的主要形式。经典以太网使用 CSMA/CD 来分配黄色花园软管内 电缆的信道，这个软管在机器之间蜿蜒穿梭。随着速度由原来 10 Mbps 提升到 10 Gbps 继续攀升，体系结构己经发生改变。现在，诸如双绞线那样的点到点链路连接着集线器和 交换机。有了现代交换机和全双工链路，链接上己经不存在竞争，交换机可以在不同的端 口之间并行地转发帧。
    
-   若要把局域网布满整个建筑物，就需要一种互连局域网的方法。即插即用的网桥就能 用于此目的。搭建网桥时需要用到后向学习算法和生成树算法。由于此功能己被纳入现代 交换机，因此术语“网桥”和“交换机”可以互换着使用。