# 1 引言

## 1.3 网络软件
[协议层次结构](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=35)

-   为了降低网络设计的复杂性，绝大多数网络都组织成一个层次栈(a stack of layer)或
-   分级栈(a stack of level)，每一层都建立在其下一层的基础之上
-   在每一对相邻层次之间的是接口(interface)

 [协议栈与网络体系结构](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=37)

-   除了尽可能地减少层与层之间必须要传递的信 息量外，层与层之间清晰的接口使得同层协议的替换更加容易，即某一层的当前协议或实 现替换成另一个完全不同的协议或者实现
    
-   ==层和协议的集合称为网络体系结构(network architecture)==
    
-   一个特定的系统所使用的一组协议，即每一层一个协议，称为协议栈 protocol stack)。网络体系结构、协议栈以及协议本身是本书的主要内容

[连接与无连接服务](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=40)

-   面向连接的服务(connection-oriented service)是按照电话系统建模的

当你想给某人打电话时，首先要拿起话机，拨对方的号码，然后说话，最后挂机。类似地，为了使用面 向连接的网络服务，服务用户首先必须建立一个连接，然后使用该连接传输数据，最后释 放该连接。这种连接最本质的方面在于它像一个管道:发送方把对象(数据位)压入管道 的一端，接收方在管道的另一端将它们取出来

在绝大多数情况下，数据位保持原来的顺 序，所以数据位都会按照发送的顺序到达

-   与面向连接服务相对应的是无连接服务(conncetionless service)，这是按照邮政系统建 模的。每个报文(信件)都携带了完整的目标地址，每个报文都由系统中的中间节点路由，而且路由独立于后续报文。报文(message)在不同的上下文中有不同的称呼;数据包/包 (packet)是网络层的报文。

-   如果中间节点只能在收到报文的全部内容之后再将该报文发送 给下一个节点，那么我们就称这种处理方式为存储-转发交换(store-and-forward switching)
    
-   有别于此的另一种处理方式是在报文还没有被全部接收完毕之前就向下一个节点传输，这 种处理方式称为直通式交换(cut-through switching)

[数据报服务](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=41)

-   不可靠(意味着没有被确认)的无连接服务通常称为数据报服务(datagram service)，它与 电报服务非常类似，一般不会给发送方反馈任何确认消息。尽管它是不可靠的，但在大多 数网络中这是一种占主导地位的传输形式，至于个中的原因我们马上就会明白
    
-   有确认的数据报服务(acknowledged datagram service)就是为这些应用 提供的一类服务。这就像在寄挂号信时要求一个回执一样。当发送方收到回执时可绝对相 信这封信已经被送到对方手中，肯定没有在投递的途中丢失。手机上的文本消息就是一个实例

-   还有另外一种服务是请求-应答服务(request-reply service)。在这种服务中，发送方传 输一个包含了某个请求的数据报;接受方以一个包含了请求结果的应答数据报作为反馈 请求-应答服务通常用在客户机-服务器模型中:客户机发出一个请求，然后服务器对此做 出响应。

[可靠连接与不可靠连接的概念辨析](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=42)

-   使用不可靠连接的概念刚开始可能会令人感到疑惑不解。毕竟，为什么会有人愿意舍 弃可靠通信而选择不可靠的通信呢
    
-   首先，在给定的层次并不是总能使用可靠通信(可靠 通信的含义是指有确认)。例如，以太网并没有提供可靠通信。有些数据包可能偶尔会在传 输过程中被损坏，上层协议必须处理这个问题。==尤其是，许多可靠服务是建立在不可靠数 据报服务之上的。==其次，为了提供可靠服务而引入的固有延迟可能令人不可接受，==特别在 诸如多媒体的实时应用中，更是无法忍受额外的延迟。由于这些原因，可靠通信和不可靠 通信将并存在任何一个网络中==

### [服务与协议的概念](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=44)

-   服务和协议是两个截然不同的概念，它们之间的区别非常重要，我们有必要在这里再 次强调。==服务是指某一层向它上一层提供的一组原语(操作)。==服务定义了该层准备代表其 用户执行哪些操作，但是它并不涉及如何实现这些操作。服务与两层之间的接口有关，低 层是服务提供者，而上层是服务用户
    
-   与此不同的是，协议是一组规则，规定了同一层上对等实体之间所交换的数据包或者 报文的格式和含义。对等实体利用协议来实现它们的服务定义，它们可以自由地改变协议 只要不改变呈现给它们用户的服务即可
    
-   ==按照这种方式，服务和协议是完全相分离的，这 是任何一个网络设计者应该很好理解的关键概念==
    
-   这里为了重复一下这个关键点，服务涉及层与层之间的接口，如图 1-19 所示。相反，协 议涉及不同机器上两个对等实体之间发送的数据包

## 1.4 参考模型
[OSI与TCP的分布意义](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=45)

-   虽然与 OSI 模型相关的协议没 有被任何人所用，但实际上，该模型本身具有相当普遍意义，并仍然有效;它对讨论网络 体系结构中每一层的功能还是很重要。TCP/IP 协议模型则具有相反的特性:模型本身没有 多大用处，但它的协议却已经广为流传

[OSI参考模型概览](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=46)

1. 物理层(physical layer)
-   关注在一条通信信道上传输原始比特
-   设计问题必须确保当一 方发送了比特 1 时，另一方收到的也是比特 1，而不是比特 0。这
    
2. 数据链路层(data link layer)
- 主要任务是将一个原始的传输设施转变成一条没有漏 检传输错误的线路
    
-   数据链路层完成这项任务的做法是将真实的错误掩盖起来，使得网络 层看不到。为此，发送方将输入的数据拆分成数据帧(data frame)，然后顺序发送这些数 据帧。一个数据帧通常为几百个或者几千个字节长。如果服务是可靠的，则接收方必须确 认正确收到的每一帧，即给发送方发回一个确认帧(acknowledgement frame)
    
-   数据链路层(和大多数高层都存在)的另一个问题是如何避免一个快速发送方用数据 淹没”一个慢速接收方。所以，往往需要一种流量调节机制，以便让发送方知道接收方何 时可以接收更多的数据
    
-   广播式网络的数据链路层还有另一个问题:如何控制对共享信道的访问。数据链路层 的一个特殊子层，即介质访问控制子层，就是专门处理这个问题的
    
3. 网络层 网络层(network layer)
- 主要功能是控制子网的运行
-   一个关键的设计问题是如何将 数据包从源端路由到接收方
-   如果有太多的数据包同时出现在一个子网中，那么这些数据包彼此之间会相互阻碍 从而形成传输瓶颈。处理拥塞也是网络层的责任，一般要和高层协议结合起来综合处理拥 塞才有效，高层协议必须适应它们注入网络中的负载。更普遍的是网络所提供的服务质量 延迟、传输时间、抖动等)也是网络层的问题
-   在广播式网络中，路由问题比较简单，所以网络层往往比较单薄，甚至根本不存在

4. 传输层(transport layer)
-   基本功能是接收来自上一层的数据，在必要的时候把这些 数据分割成较小的单元，然后把这些数据单元传递给网络层，并且确保这些数据单元正确 地到达另一端。而
    
-   而且，所有这些工作都必须高效率同时以一种上下隔离的方式完成，即随 着时间的推移导致底层硬件技术不可避免地发生改变时，对上面各层是透明的
    
-   传输层是真正的端-端的层，它自始自终将数据从源端携带到接收方。换句话说，源机 器上的一个程序利用报文头和控制信息与目标机器上的一个类似程序进行会话
    
5. 会话层(session layer)
-   允许不同机器上的用户建立会话
    
-   会话通常提供各种服务，包 括对话控制(dialog control)(记录该由谁来传递数据)、令牌管理(token management)(禁 止双方同时执行同一个关键操作)，以及同步功能(synchronization)(在一个长传输过程中 设置一些断点，以便在系统崩溃之后还能恢复到崩溃前的状态继续运行)
    
6. 表示层(presentation layer)
-   以下的各层最关注的是如何传递数据位，而表示层关注的 是所传递信息的语法和语义
    
-   第 1 层到第 3 层是链式连接的，而第 4 层到第 7 层是端-端的，两者之间的区别如图 1-20 所示

7. 应用层(application layer)
-  包含了用户通常需要的各种各样的协议

==在网络中通过下面三层（即：1 2 3层）进行主机间的通信==

[TCP/IP参考模型概览](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=48)

1. 应用层(application layer)
-   包含了用户通常需要的各种各样的协议
    
-   用的应用协议是超文本传输协议(HTTP，HyperText Transfer Protocol)，它是万维网(WWW World Wide Web)的基础。当浏览器需要一个 Web 页面时，它通过 HTTP 将所要页面的名 字发送给服务器，然后服务器将页面发回给浏览器。其他一些应用协议可用于文件传输 电子邮件以及网络新闻等
    
2. 链路层 
-   所有这些要求导致本参考模型选择了数据包交换网络，它以一个可运行在不同网络之 上的无连接网络层为基础。模型中的最低层是链路层(link layer)，该层描述了链路必须完 成什么功能才能满足无连接的互联网络层的需求，比如串行线和经典以太网链路。这不是 真正意义上的一个层，而是主机与传输线路之间的一个接口。TCP/IP 模型的早期文档很少 提到这点
    
3. 互联网层(internet layer)
-   是将整个网络体系结构贯穿在一起的关键层

[TCP分层详细理解](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=49)

- 向上兼容：
可以使用不同的应用层网络传输协议。支持因特网的应用是非常扩展的。
- 向下兼容：
用户互联网接入方式在不断变化，从主机到网络的基于IP和ICMP的接入方式可以不断扩展。

- 先有协议，TCP/IP模型只是已有协议的一个描述而已===>**模型与协议高度吻合**
- 但TCP/IP不适合任何其他协议栈，描述其他非此的网络，该模型不很有用。
- 无连接和面向连接的通信领域：TCP/IP仅支持无连接一种模式。但在传输层同时支持两种。对于简单的“请求-应答”协议非常重要。



### [两种参考模型的比较](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=51)
-   OSI 和 TCP/IP 参考模型有很多共同点。两者都以协议栈概念为基础，并且协议栈中的 协议彼此相互独立。除此之外，两个模型中各个层的功能也大致相似。例如，在两个模型 中，传输层以及传输层以上各层都为希望通信的进程提供了一种端-端的独立于网络的传输 服务。这些层组成了传输服务提供者。而且，在这两个模型中，传输层之上的各层都是传 输服务的用户，并且是面向应用的
    
-   ==OSI 模型的核心是如下 3 个概念 1)服务 2)接口 3)协议==
    
-   或许 OSI 模型的最大贡献在于明确区分了这 3 个概念。每一层都为它的上一层执行某 些服务。服务定义说明了该层是做什么的，而不是上一层实体如何访问这一层，或这一层 是如何工作的。它定义了这一层的语义 每一层的接口告诉它上面的进程如何访问本层。它规定了有哪些参数，以及结果是什 么。但它没有说明本层内部是如何工作
    
-   这些思想与现代面向对象的程序设计思想非常吻合。一个对象就如同一个层一样，它 有一组方法(或者称为操作)供对象之外的过程调用。这些方法的语义定义了该对象所提 供的服务集合。方法的参数和结果构成了对象的接口。对象的内部代码是它的协议，对于 外部而言是不可见的，也不需要被外界关心

[对比细节理解](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=52)

-   OSI 参考模型在协议发明之前就已经产生了。这种顺序关系意味着 OSI 模型不会偏向 于任何一组特定的协议，这个事实使得 OSI 模型更具有通用性
    
-   例如，数据链路层最初只处理点-点网络。当广播式网络出现后，必须在模型中嵌入一 个新的子层。而且，当人们使用 OSI 模型和已有协议来构建实际网络时，才发现这些网络 并不能很好地满足所需的服务规范，因此不得不在模型中加入一些汇聚子层，以便提供足 够的空间来弥补这些差异。最
    
-   而 TCP/IP 却正好相反:先有协议，TCP/IP 模型只是已有协议的一个描述而已。所以 毫无疑问，协议与模型高度吻合，而且两者结合得非常完美。唯一的问题在于，TCP/IP 模 型并不适合任何其他协议栈。因此，要想描述其他非 TCP/IP 网络，该模型并不很有用
    
-   另一个区别在于无连接和面向连接的通信领域有所不同。==OSI 模型的网络层同时支持无连接和面向连接的通信，但是传输层只支持面向连接的通信，这是由该层的特点所决定 的(因为传输服务对于用户是可见的)。== ==TCP/IP 模型在网络层只支持一种模式(无连接) 但是在传输层同时支持两种通信模式，这样可以给用户一个选择的机会。==这种选择机会对 于简单的“请求-应答”协议特别重要


## 1.5 网络实例
### [网络实例-因特网](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=55)

-   因特网(Internet)并不是单个网络，而是大量不同网络的集合，这些网络使用特定的 公共协议，并提供特定的公共服务。Internet 是一个不同寻常的系统，它不是由任何人规划 出来的，也不受任何人控制

[Internet 的体系结构](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=60)

**ISP networks serve as the Internet backbone**
不是单一的网络 是大量不同网络的集合
网中网


## 小结
[第一章——引言小结](x-devonthink-item://FB62D424-1B13-4740-A33F-51B1C18AEF67?page=79)

-   网络软件由网络协议组成，而协议是进程通信必须遵守的规则。大多数网络支持协议 的层次结构，每一层向它的上一层提供服务，同时屏蔽掉较低层使用的协议细节。协议栈 通常基于 OSI 模型或者 TCP/IP 模型。这两个模型都有链路层、网络层、传输层和应用层
-   网络为它们的用户提供不同的服务。服务的范围从无连接的尽力而为数据包传递服务 到面向连接的有质量保证服务。在某些网络中，无连接服务由某一层提供，而面向连接的 服务则由它上面的层提供



## Q&A——ch1
- 使用协议栈的原因？

> 使用协议栈 分层的根本原因：降低网络 设计的复杂度
- 协议栈的定义？
- 虚线实现代表啥？虚线不是直接通信的结构 实线代表进行真实的通信
- 可靠的代表什么？ack 有确认的数据报服务
- 为什么要用不可靠连接？用不可靠服务上层的可靠层来保证服务的正确执行。可靠建立在不可靠之上；减少延迟等


